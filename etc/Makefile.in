include ../Makefile.inc

all:
	cat unicorn.conf.in | sed -e 's#@CONFDIR@#$(sysconfdir)/$(TARGETNAME)#g' -e 's#@MODDIR@#$(MODDIR)#g' > unicorn.conf

install: all
	mkdir -p $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)
	# modules.conf contains credentials - use restrictive permissions (600)
	# Don't overwrite existing to preserve user's database password
	@if [ ! -f $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)/modules.conf ]; then \
		$(INSTALL) -m 600 modules.conf $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)/; \
	else \
		echo "*** modules.conf exists, installing as modules.conf.new"; \
		$(INSTALL) -m 600 modules.conf $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)/modules.conf.new; \
	fi
	# Other config files - use 644 (not executable)
	$(INSTALL) -m 644 payloads.conf $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)
	$(INSTALL) -m 644 unicorn.conf $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)
	$(INSTALL) -m 644 oui.txt $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)
	$(INSTALL) -m 644 ports.txt $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)
	$(CHCON) -R system_u:object_r:unicornscan_share_t $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)

uninstall:
	rm -f $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)/modules.conf
	rm -f $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)/oui.conf
	rm -f $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)/payloads.conf
	rm -f $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)/port-numbers
	rm -f $(DESTDIR)/$(sysconfdir)/$(TARGETNAME)/unicorn.conf

clean:

distclean: clean
	rm -f unicorn.conf
