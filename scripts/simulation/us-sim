#!/usr/bin/env bash
# Unicornscan Simulation Wrapper
# Drop-in replacement for 'us' command for testing purposes
#
# Copyright (c) 2025 Robert E. Lee <robert@unicornscan.org>
#
# Usage: ./us-sim [unicornscan options] target
#
# This wrapper provides an authentic simulation of unicornscan output
# based on the real C source code patterns.

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Check if Node.js/npx is available
if ! command -v npx &> /dev/null; then
    echo "Error: Node.js (npx) is required for the simulation" >&2
    exit 1
fi

# Run the TypeScript simulation using ts-node or tsx
if command -v tsx &> /dev/null; then
    exec tsx "$SCRIPT_DIR/unicornscan-sim.ts" "$@"
elif command -v ts-node &> /dev/null; then
    exec ts-node "$SCRIPT_DIR/unicornscan-sim.ts" "$@"
else
    # Try using npx to run ts-node
    exec npx --yes ts-node "$SCRIPT_DIR/unicornscan-sim.ts" "$@"
fi
